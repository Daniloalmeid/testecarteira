<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Conectar Phantom</title>
  <script src="https://cdn.jsdelivr.net/npm/tweetnacl@1.0.3/nacl.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tweetnacl-util@0.15.1/nacl-util.min.js"></script>
</head>
<body>
  <h2>Conectar com Phantom</h2>
  <button onclick="connectPhantom()">Conectar</button>
  <p id="status">Esperando conexão...</p>

  <script>
    const status = document.getElementById("status");

    function isMobile() {
      return /android|iphone|ipad|ipod/i.test(navigator.userAgent.toLowerCase());
    }

    function connectPhantom() {
      if (window.solana && window.solana.isPhantom && !isMobile()) {
        // DESKTOP com extensão
        window.solana.connect()
          .then(({ publicKey }) => {
            status.innerText = "Carteira conectada: " + publicKey.toString();
          })
          .catch(err => {
            console.error(err);
            status.innerText = "Erro ao conectar: " + err.message;
          });
      } else {
        // MOBILE com deep link
        const keyPair = nacl.box.keyPair();
        const dappPublicKey = keyPair.publicKey;
        const dappPrivateKey = keyPair.secretKey;

        const publicKeyBase64 = nacl.util.encodeBase64(dappPublicKey);
        const privateKeyBase64 = nacl.util.encodeBase64(dappPrivateKey);

        const appUrl = encodeURIComponent("https://daniloalmeid.github.io/testecarteira/index.html");
        const redirectLink = encodeURIComponent(`https://daniloalmeid.github.io/testecarteira/callback.html?dapp_private_key=${privateKeyBase64}`);

        const phantomLink = `https://phantom.app/ul/v1/connect?app_url=${appUrl}&redirect_link=${redirectLink}&dapp_encryption_public_key=${publicKeyBase64}`;

        window.location.href = phantomLink;
      }
    }
  </script>
</body>
</html>
